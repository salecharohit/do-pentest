# Execute all commands w/o sudo
apt update -y
apt-add-repository ppa:ansible/ansible -y
# Basic Software Installation
apt install wget git jq apt-transport-https ca-certificates curl software-properties-common nginx ansible -y
# File and Folder Movement
mv /tmp/ansible /home/ansible
rm /var/www/html/*.html
mv /home/ansible/nginx/index.html /var/www/html/index.html
# Execute Ansible Playbook
ansible-playbook -i /home/ansible/inventory /home/ansible/playbook.yml
service nginx restart

# Create Ubuntu a non-root user
adduser --disabled-password --gecos '' ubuntu
usermod -aG sudo ubuntu
mkdir -p /home/ubuntu/.ssh
touch /home/ubuntu/.ssh/authorized_keys
cat /tmp/pentest_key.pub > authorized_keys
mv authorized_keys /home/ubuntu/.ssh
chown -R ubuntu:ubuntu /home/ubuntu/.ssh
chmod 700 /home/ubuntu/.ssh
chmod 600 /home/ubuntu/.ssh/authorized_keys

# Harden SSH
sed -i 's/PermitRootLogin yes/PermitRootLogin no/g' /etc/ssh/sshd_config
sed -i "s/.*PasswordAuthentication.*/PasswordAuthentication no/g" /etc/ssh/sshd_config
service ssh reload
